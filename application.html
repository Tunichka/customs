<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мои заявки | ТаможСервис</title>
    <link rel="stylesheet" href="application.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Дополнительные стили для отображения ролей и административных элементов */
        
        
        .user-menu {
            position: relative;
        }
        
        .user-icon {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
            color: #2c3e50;
            text-decoration: none;
        }
        
        .user-icon:hover {
            background-color: #d0ecff;
            transform: translateY(-2px);
        }
        
        .user-icon i {
            font-size: 20px;
        }
        
        .user-text {
    font-size: 15px;
    font-weight: 500;
}
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 250px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-top: 10px;
            display: none;
            z-index: 1000;
            overflow: hidden;
        }
        
        .user-dropdown.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        .user-dropdown-header {
            padding: 15px;
            background: linear-gradient(135deg, #2c3e50, #2980b9);
            color: white;
        }
        
        .user-dropdown-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .user-dropdown-email {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        .user-dropdown-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #2c3e50;
            text-decoration: none;
            transition: background-color 0.3s;
            border-bottom: 1px solid #eee;
        }
        
        .user-dropdown-item:last-child {
            border-bottom: none;
        }
        
        .user-dropdown-item:hover {
            background-color: #f8f9fa;
            color: #2980b9;
        }
        
        .user-dropdown-item i {
            width: 20px;
            color: #2980b9;
        }
        
        .user-dropdown-divider {
            height: 1px;
            background-color: #eee;
            margin: 5px 0;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 10px;
            background-color: #e8f4fd;
            color: #2980b9;
        }
        .role-badge.admin {
            background-color: #2c3e50;
            color: white;
        }
        .user-info-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .requester-info {
            font-size: 0.9rem;
            background-color: #f0f7ff;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .requester-info i {
            color: #2980b9;
        }
        .admin-actions {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #ccc;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .status-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .admin-only {
            display: none;
        }
        body.admin-mode .admin-only {
            display: block;
        }

        /* Стили для выпадающего меню */
.dropdown {
    position: relative;
}

.dropdown-toggle {
    display: flex;
    align-items: center;
    gap: 5px;
}

.dropdown-toggle i {
    font-size: 12px;
    transition: transform 0.3s ease;
}

.dropdown:hover .dropdown-toggle i {
    transform: rotate(180deg);
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    background: white;
    min-width: 200px;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    padding: 10px 0;
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition: all 0.3s ease;
    z-index: 1000;
    border: 1px solid rgba(0, 40, 104, 0.08);
}

.dropdown:hover .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(5px);
}

.dropdown-menu li {
    list-style: none;
    display: block;
    width: 100%;
    margin: 0;
    padding: 0;
    float: none;
    clear: both;
}

.dropdown-menu a {
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    color: #333;
    transition: all 0.3s ease;
    font-weight: 500;
    white-space: nowrap;
    width: 100%;
    box-sizing: border-box;
}

.dropdown-menu a i {
    width: 18px;
    color: #002868;
    font-size: 14px;
    text-align: center;
}

.dropdown-menu a:hover {
    background: rgba(0, 40, 104, 0.05);
    color: #002868;
}

/* Дополнительные стили для активного состояния */
.dropdown-menu a.active {
    background: #002868;
    color: white;
}

.dropdown-menu a.active i {
    color: white;
}

/* Стили для разделителя в меню */
.dropdown-divider {
    height: 1px;
    background: rgba(0, 40, 104, 0.08);
    margin: 8px 0;
}

/* Важно! Переопределяем возможные глобальные стили */
.dropdown-menu li,
.dropdown-menu li * {
    display: block;
}

.dropdown-menu ul,
.dropdown-menu li,
.dropdown-menu a {
    float: none;
}

.dropdown-menu {
    display: block;
}

.dropdown-menu li {
    display: list-item;
}

/* Выравнивание иконок и текста */
.dropdown-menu a {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 12px 24px;
}

.dropdown-menu a i {
    width: 18px;
    font-size: 15px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Увеличиваем размер окна */
.dropdown-menu {
    min-width: 220px;
    padding: 12px 0;
}

.logo {
    display: flex;
    align-items: center;
    font-size: 24px;
    font-weight: 700;
    color: #002868;
}

.logo svg,
.logo img {
    width: 32px;
    height: 32px;
    flex-shrink: 0;
}
    </style>
</head>
<body>
    <!-- Header & Navigation -->
    <header>
        <div class="container header-container">
           <div class="logo">
            <img src="logo_icon.svg" alt="ТаможСервис" width="32" height="32">
            Тамож<span>Сервис</span>
        </div>
        <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <nav>
                <ul id="mainMenu">
                    <li><a href="index.html">Главная</a></li>
                    <li><a href="index.html#services">Услуги</a></li>
                    <li><a href="calculator.html">Калькулятор ВЭД</a></li>
                    <li><a href="application.html" class="active">Мои заявки</a></li>
                    <li><a href="index.html#directions">Направления</a></li>
                    <li class="dropdown">
                    <a href="#" class="dropdown-toggle">О нас <i class="fas fa-chevron-down"></i></a>
                    <ul class="dropdown-menu">
                        <li><a href="about.html"><i class="fas fa-building"></i> О компании</a></li>
                        <li><a href="#contacts"><i class="fas fa-map-marker-alt"></i> Контакты</a></li>
                    </ul>
                </li>
                </ul>
            </nav>
            <div class="header-actions user-menu" id="userMenuContainer">
                <a href="auth.html" class="user-icon" id="userMenu">
                    <i class="fas fa-user-circle"></i>
                    <span class="user-text">Загрузка...</span>
                </a>
                <!-- Выпадающее меню пользователя -->
                <div class="user-dropdown" id="userDropdown">
                    <div class="user-dropdown-header">
                        <div class="user-dropdown-name" id="dropdownUserName">Пользователь</div>
                        <div class="user-dropdown-email" id="dropdownUserEmail">email@example.com</div>
                        <div class="user-dropdown-role" id="dropdownUserRole"></div>
                    </div>
                    <a href="auth.html" class="user-dropdown-item">
                        <i class="fas fa-user"></i> Мой профиль
                    </a>
                    <a href="application.html" class="user-dropdown-item">
                        <i class="fas fa-clipboard-list"></i> Мои заявки
                    </a>
                    <a href="calculator.html" class="user-dropdown-item">
                        <i class="fas fa-calculator"></i> Калькулятор
                    </a>
                    <div class="user-dropdown-divider"></div>
                    <a href="#" class="user-dropdown-item" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Выйти
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Основной контент страницы -->
    <div id="mainContent">
        <!-- Список заявок -->
        <section class="requests-page" id="requestsListView">
            <div class="container">
                <div class="page-header">
                    <div class="page-title user-info-header">
                        <div>
                            <i class="fas fa-clipboard-list"></i>
                            <h1 style="display: inline-block; margin-left: 10px;">Мои заявки</h1>
                        </div>
                        <span id="userRoleBadge" class="role-badge"></span>
                    </div>
                    <button class="new-request-btn" id="newRequestBtn">
                        <i class="fas fa-plus-circle"></i>
                        Создать заявку
                    </button>
                </div>

                <!-- Статистика -->
                <div class="stats-cards" id="statsCards">
                    <!-- Динамически заполняется через JS -->
                </div>

                <!-- Фильтры -->
                <div class="filters-section">
                    <div class="filters-title">
                        <i class="fas fa-filter"></i>
                        <span>Фильтры</span>
                    </div>
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>Статус</label>
                            <select id="statusFilter">
                                <option value="all">Все статусы</option>
                                <option value="new">Новая</option>
                                <option value="processing">В обработке</option>
                                <option value="completed">Завершена</option>
                                <option value="cancelled">Отменена</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Дата с</label>
                            <input type="date" id="dateFrom">
                        </div>
                        <div class="filter-group">
                            <label>Дата по</label>
                            <input type="date" id="dateTo">
                        </div>
                        <div class="filter-group">
                            <label>Поиск</label>
                            <input type="text" id="searchFilter" placeholder="Название, описание...">
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button class="filter-btn apply" id="applyFiltersBtn">
                            <i class="fas fa-check"></i> Применить
                        </button>
                        <button class="filter-btn reset" id="resetFiltersBtn">
                            <i class="fas fa-undo"></i> Сбросить
                        </button>
                    </div>
                </div>

                <!-- Список заявок -->
                <div id="requestsList">
                    <!-- Динамически заполняется через JS -->
                </div>
            </div>
        </section>

        <!-- Детальная страница заявки -->
        <section class="request-detail-page" id="requestDetailView" style="display: none;">
            <div class="container">
                <div class="request-detail-header">
                    <a href="#" class="back-btn" id="backToListBtn">
                        <i class="fas fa-arrow-left"></i>
                        Вернуться к списку
                    </a>
                    <span class="status-badge" id="detailStatusBadge"></span>
                </div>
                
                <div class="request-detail-card" id="requestDetailContent">
                    <!-- Динамически заполняется через JS -->
                </div>
            </div>
        </section>
    </div>

    <!-- Модальное окно создания заявки -->
    <div class="modal" id="newRequestModal">
        <div class="modal-content">
            <button class="modal-close" id="closeModalBtn">&times;</button>
            <h2 class="modal-title">Новая заявка</h2>
            
            <form id="newRequestForm">
                <div class="form-group">
                    <label for="requestName">Название заявки *</label>
                    <input type="text" id="requestName" required placeholder="Например: Таможенное оформление груза">
                </div>
                
                <div class="form-group">
                    <label for="requestService">Вид услуги *</label>
                    <select id="requestService" required>
                        <option value="">Выберите услугу</option>
                        <option value="customs">Таможенное оформление</option>
                        <option value="certification">Сертификация</option>
                        <option value="declaration">Декларирование</option>
                        <option value="logistics">Логистика</option>
                        <option value="consulting">Консультация</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="requestDescription">Описание заявки *</label>
                    <textarea id="requestDescription" rows="4" required placeholder="Подробно опишите вашу задачу..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="requestPriority">Приоритет</label>
                    <select id="requestPriority">
                        <option value="low">Низкий</option>
                        <option value="medium" selected>Средний</option>
                        <option value="high">Высокий</option>
                        <option value="urgent">Срочный</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="requestDeadline">Желаемая дата завершения</label>
                    <input type="date" id="requestDeadline">
                </div>
                
                <button type="submit" class="auth-btn">
                    <i class="fas fa-paper-plane"></i> Отправить заявку
                </button>
            </form>
        </div>
    </div>

    <!-- Модальное окно изменения статуса (только для админа) -->
    <div class="modal" id="changeStatusModal">
        <div class="modal-content">
            <button class="modal-close" id="closeStatusModalBtn">&times;</button>
            <h2 class="modal-title">Изменить статус заявки</h2>
            <form id="changeStatusForm">
                <div class="form-group">
                    <label for="newStatus">Новый статус</label>
                    <select id="newStatus" class="status-select" required>
                        <option value="new">Новая</option>
                        <option value="processing">В обработке</option>
                        <option value="completed">Завершена</option>
                        <option value="cancelled">Отменена</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="statusComment">Комментарий</label>
                    <textarea id="statusComment" rows="3" placeholder="Причина изменения статуса..."></textarea>
                </div>
                <button type="submit" class="auth-btn">Сохранить</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>ТаможСервис</h3>
                    <p>Профессиональное таможенное оформление грузов из Китая, Беларуси и России. Полное сопровождение "под ключ".</p>
                </div>
                <div class="footer-column">
                    <h3>Навигация</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Главная</a></li>
                        <li><a href="index.html#services">Услуги</a></li>
                        <li><a href="calculator.html">Калькулятор ВЭД</a></li>
                        <li><a href="application.html">Мои заявки</a></li>
                        <li><a href="index.html#directions">Направления</a></li>
                        <li><a href="index.html#contacts">Контакты</a></li>
                        <li><a href="about.html">О компании</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Контакты</h3>
                    <ul class="footer-links">
                        <li><i class="fas fa-phone-alt"></i> +7 (333) 335-33-33</li>
                        <li><i class="fas fa-map-marker-alt"></i> Москва, Павелецкая площадь, 3</li>
                        <li><i class="fas fa-envelope"></i> info@company.ru</li>
                        <li><i class="fas fa-clock"></i> Пн-Пт 9:00-19:00 (МСК)</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 ТаможСервис. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <script>
        // ========== МОКОВЫЕ ДАННЫЕ С РАЗДЕЛЕНИЕМ ПО РОЛЯМ ==========
        const mockUsers = [
            { id: 'user1', email: 'user@example.com', name: 'Иван Иванов', role: 'user' },
            { id: 'admin1', email: 'admin@example.com', name: 'Администратор', role: 'admin' }
        ];

        // Заявки с привязкой к пользователям
        const mockRequests = [
            {
                id: 'REQ-2024-001',
                userId: 'user1',
                userName: 'Иван Иванов',
                userEmail: 'user@example.com',
                name: 'Таможенное оформление оборудования',
                description: 'Необходимо оформить таможенную декларацию на производственное оборудование из Китая. Оборудование: станки ЧПУ, 3 единицы. Стоимость: 45,000$',
                service: 'customs',
                serviceName: 'Таможенное оформление',
                priority: 'high',
                priorityName: 'Высокий',
                status: 'processing',
                statusName: 'В обработке',
                contractor: {
                    name: 'Иванов Алексей Петрович',
                    role: 'Старший таможенный брокер',
                    company: 'ТаможСервис',
                    avatar: 'https://ui-avatars.com/api/?name=Иванов+Алексей&background=2980b9&color=fff'
                },
                createdAt: '2024-01-15T10:30:00',
                deadline: '2024-02-15',
                completedAt: null,
                timeline: [
                    { date: '2024-01-15T10:30:00', status: 'new', statusName: 'Новая', comment: 'Заявка создана' },
                    { date: '2024-01-16T09:15:00', status: 'processing', statusName: 'В обработке', comment: 'Назначен ответственный: Иванов Алексей Петрович' },
                    { date: '2024-01-17T14:20:00', status: 'processing', statusName: 'В обработке', comment: 'Начат сбор документов' }
                ]
            },
            {
                id: 'REQ-2024-002',
                userId: 'user1',
                userName: 'Иван Иванов',
                userEmail: 'user@example.com',
                name: 'Сертификация продукции',
                description: 'Требуется оформить сертификат соответствия на детскую одежду. Товар: куртки детские (1000 шт). Страна производства: Россия',
                service: 'certification',
                serviceName: 'Сертификация',
                priority: 'medium',
                priorityName: 'Средний',
                status: 'new',
                statusName: 'Новая',
                contractor: {
                    name: 'Петрова Елена Сергеевна',
                    role: 'Менеджер по сертификации',
                    company: 'ТаможСервис',
                    avatar: 'https://ui-avatars.com/api/?name=Петрова+Елена&background=2980b9&color=fff'
                },
                createdAt: '2024-01-20T15:45:00',
                deadline: '2024-02-10',
                completedAt: null,
                timeline: [
                    { date: '2024-01-20T15:45:00', status: 'new', statusName: 'Новая', comment: 'Заявка создана' },
                    { date: '2024-01-21T11:30:00', status: 'processing', statusName: 'В обработке', comment: 'Назначен ответственный: Петрова Елена Сергеевна' }
                ]
            },
            {
                id: 'REQ-2024-003',
                userId: 'admin1',
                userName: 'Администратор',
                userEmail: 'admin@example.com',
                name: 'Декларирование товаров',
                description: 'Подача декларации на партию бытовой техники. Товар: холодильники (50 шт), стиральные машины (30 шт). Страна: Китай',
                service: 'declaration',
                serviceName: 'Декларирование',
                priority: 'urgent',
                priorityName: 'Срочный',
                status: 'completed',
                statusName: 'Завершена',
                contractor: {
                    name: 'Смирнов Дмитрий Владимирович',
                    role: 'Специалист по декларированию',
                    company: 'ТаможСервис',
                    avatar: 'https://ui-avatars.com/api/?name=Смирнов+Дмитрий&background=2980b9&color=fff'
                },
                createdAt: '2024-01-10T09:00:00',
                deadline: '2024-01-20',
                completedAt: '2024-01-18T16:30:00',
                timeline: [
                    { date: '2024-01-10T09:00:00', status: 'new', statusName: 'Новая', comment: 'Заявка создана' },
                    { date: '2024-01-10T10:15:00', status: 'processing', statusName: 'В обработке', comment: 'Назначен ответственный: Смирнов Дмитрий Владимирович' },
                    { date: '2024-01-15T13:20:00', status: 'processing', statusName: 'В обработке', comment: 'Декларация подана в таможенный орган' },
                    { date: '2024-01-18T16:30:00', status: 'completed', statusName: 'Завершена', comment: 'Товар выпущен, заявка выполнена' }
                ]
            },
            {
                id: 'REQ-2024-004',
                userId: 'user1',
                userName: 'Иван Иванов',
                userEmail: 'user@example.com',
                name: 'Международная логистика',
                description: 'Организация доставки сборного груза из Шанхая в Москву. Груз: электроника, 15 паллет, 1200 кг',
                service: 'logistics',
                serviceName: 'Логистика',
                priority: 'high',
                priorityName: 'Высокий',
                status: 'cancelled',
                statusName: 'Отменена',
                contractor: {
                    name: 'Козлов Андрей Игоревич',
                    role: 'Логист-международник',
                    company: 'ТаможСервис',
                    avatar: 'https://ui-avatars.com/api/?name=Козлов+Андрей&background=2980b9&color=fff'
                },
                createdAt: '2024-01-05T11:20:00',
                deadline: '2024-01-25',
                completedAt: '2024-01-07T14:15:00',
                timeline: [
                    { date: '2024-01-05T11:20:00', status: 'new', statusName: 'Новая', comment: 'Заявка создана' },
                    { date: '2024-01-06T09:30:00', status: 'processing', statusName: 'В обработке', comment: 'Назначен ответственный: Козлов Андрей Игоревич' },
                    { date: '2024-01-07T14:15:00', status: 'cancelled', statusName: 'Отменена', comment: 'Заявка отменена клиентом' }
                ]
            },
            {
                id: 'REQ-2024-005',
                userId: 'admin1',
                userName: 'Администратор',
                userEmail: 'admin@example.com',
                name: 'Консультация по ВЭД',
                description: 'Необходима консультация по классификации товаров по ТН ВЭД. Товар: оптические приборы, лабораторное оборудование',
                service: 'consulting',
                serviceName: 'Консультация',
                priority: 'low',
                priorityName: 'Низкий',
                status: 'completed',
                statusName: 'Завершена',
                contractor: {
                    name: 'Николаева Мария Андреевна',
                    role: 'Ведущий консультант',
                    company: 'ТаможСервис',
                    avatar: 'https://ui-avatars.com/api/?name=Николаева+Мария&background=2980b9&color=fff'
                },
                createdAt: '2024-01-18T14:10:00',
                deadline: '2024-01-19',
                completedAt: '2024-01-19T11:45:00',
                timeline: [
                    { date: '2024-01-18T14:10:00', status: 'new', statusName: 'Новая', comment: 'Заявка создана' },
                    { date: '2024-01-18T15:00:00', status: 'processing', statusName: 'В обработке', comment: 'Назначен ответственный: Николаева Мария Андреевна' },
                    { date: '2024-01-19T11:45:00', status: 'completed', statusName: 'Завершена', comment: 'Консультация проведена, подготовлены рекомендации' }
                ]
            }
        ];

        // ========== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ==========
        let currentUser = null;
        let requests = [];

        // ========== ИНИЦИАЛИЗАЦИЯ ==========
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadRequests();
            setupEventListeners();
            setupUserMenu();
            
            // Mobile menu toggle
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mainMenu = document.getElementById('mainMenu');
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function() {
                    mainMenu.classList.toggle('active');
                    const icon = mobileMenuBtn.querySelector('i');
                    if (mainMenu.classList.contains('active')) {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-times');
                    } else {
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });
            }
        });

        // ========== ПРОВЕРКА АВТОРИЗАЦИИ ==========
        function checkAuth() {
            const userData = localStorage.getItem('user') || sessionStorage.getItem('user');
            if (userData) {
                try {
                    currentUser = JSON.parse(userData);
                    // Добавляем роль, если её нет (для совместимости со старыми данными)
                    if (!currentUser.role) {
                        currentUser.role = currentUser.email === 'admin@example.com' ? 'admin' : 'user';
                    }
                    if (!currentUser.id) {
                        currentUser.id = currentUser.email === 'admin@example.com' ? 'admin1' : 'user1';
                    }
                } catch (e) {
                    console.error('Ошибка парсинга пользователя', e);
                    redirectToAuth();
                }
            } else {
                redirectToAuth();
            }
        }

        function redirectToAuth() {
            alert('Пожалуйста, авторизуйтесь для просмотра заявок');
            window.location.href = 'auth.html';
        }

        // ========== ЗАГРУЗКА ЗАЯВОК (С ФИЛЬТРАЦИЕЙ ПО РОЛИ) ==========
        function loadRequests() {
            const savedRequests = localStorage.getItem('requests');
            if (savedRequests) {
                requests = JSON.parse(savedRequests);
            } else {
                requests = [...mockRequests];
                localStorage.setItem('requests', JSON.stringify(requests));
            }

            // Фильтрация по роли
            let visibleRequests = requests;
            if (currentUser.role !== 'admin') {
                // Обычный пользователь видит только свои заявки
                visibleRequests = requests.filter(req => req.userId === currentUser.id);
            }

            // Сохраняем отфильтрованные для отображения, но полный массив сохраняем в localStorage
            window.filteredRequests = visibleRequests;
            
            renderStats(visibleRequests);
            renderRequests(visibleRequests);
            updateUserInterface();
        }

        // ========== ОБНОВЛЕНИЕ ИНТЕРФЕЙСА ПОЛЬЗОВАТЕЛЯ ==========
        function updateUserInterface() {
            // Отображаем бейдж роли в заголовке
            const roleBadge = document.getElementById('userRoleBadge');
            if (roleBadge) {
                if (currentUser.role === 'admin') {
                    roleBadge.textContent = 'Администратор';
                    roleBadge.classList.add('admin');
                    document.body.classList.add('admin-mode');
                } else {
                    roleBadge.textContent = 'Пользователь';
                    roleBadge.classList.remove('admin');
                    document.body.classList.remove('admin-mode');
                }
            }

            // Обновляем выпадающее меню
            const userMenu = document.getElementById('userMenu');
            if (userMenu) {
                const userText = userMenu.querySelector('.user-text');
                userText.textContent = currentUser.name ? currentUser.name.split(' ')[0] : 'Профиль';
            }
            const dropdownName = document.getElementById('dropdownUserName');
            const dropdownEmail = document.getElementById('dropdownUserEmail');
            const dropdownRole = document.getElementById('dropdownUserRole');
            if (dropdownName) dropdownName.textContent = currentUser.name || 'Пользователь';
            if (dropdownEmail) dropdownEmail.textContent = currentUser.email || '';
            if (dropdownRole) {
                dropdownRole.textContent = currentUser.role === 'admin' ? 'Администратор' : 'Клиент';
                dropdownRole.className = `user-dropdown-role role-badge ${currentUser.role}`;
            }
        }

        // ========== НАСТРОЙКА ВЫПАДАЮЩЕГО МЕНЮ ==========
        function setupUserMenu() {
            const userIcon = document.getElementById('userMenu');
            const dropdown = document.getElementById('userDropdown');
            
            if (userIcon) {
                userIcon.href = 'javascript:void(0)';
                userIcon.addEventListener('click', function(e) {
                    e.preventDefault();
                    dropdown.classList.toggle('active');
                });
            }

            // Закрытие при клике вне меню
            document.addEventListener('click', function(e) {
                if (!userIcon?.contains(e.target) && !dropdown?.contains(e.target)) {
                    dropdown?.classList.remove('active');
                }
            });

            // Кнопка выхода
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.removeItem('user');
                    sessionStorage.removeItem('user');
                    window.location.href = 'auth.html';
                });
            }
        }

        // ========== ОТРИСОВКА СТАТИСТИКИ ==========
        function renderStats(requestsToRender) {
            const total = requestsToRender.length;
            const active = requestsToRender.filter(r => r.status === 'new' || r.status === 'processing').length;
            const completed = requestsToRender.filter(r => r.status === 'completed').length;
            const cancelled = requestsToRender.filter(r => r.status === 'cancelled').length;
            
            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-icon total">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${total}</h3>
                        <p>Всего заявок</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon active">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${active}</h3>
                        <p>В работе</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon completed">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${completed}</h3>
                        <p>Завершено</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon cancelled">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${cancelled}</h3>
                        <p>Отменено</p>
                    </div>
                </div>
            `;
            
            document.getElementById('statsCards').innerHTML = statsHTML;
        }

        // ========== ОТРИСОВКА СПИСКА ЗАЯВОК ==========
        function renderRequests(requestsToRender) {
            const requestsList = document.getElementById('requestsList');
            
            if (requestsToRender.length === 0) {
                requestsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <h2 class="empty-state-title">Заявок не найдено</h2>
                        <p class="empty-state-text">
                            ${document.getElementById('searchFilter').value ? 
                                'Попробуйте изменить параметры поиска' : 
                                'Создайте первую заявку, и она появится здесь'}
                        </p>
                        <button class="new-request-btn" onclick="document.getElementById('newRequestBtn').click()">
                            <i class="fas fa-plus-circle"></i>
                            Создать заявку
                        </button>
                    </div>
                `;
                return;
            }
            
            const requestsHTML = requestsToRender.map(request => {
                // Для администратора показываем, кто создал заявку
                const requesterInfo = (currentUser.role === 'admin' && request.userId !== currentUser.id) ? `
                    <div class="requester-info">
                        <i class="fas fa-user"></i>
                        <span><strong>Заказчик:</strong> ${request.userName || 'Неизвестно'} (${request.userEmail || ''})</span>
                    </div>
                ` : '';

                return `
                <div class="request-card status-${request.status}">
                    ${requesterInfo}
                    <div class="request-header">
                        <div class="request-title">
                            <span class="request-id">${request.id}</span>
                            <a href="#" class="request-name" onclick="showRequestDetail('${request.id}'); return false;">
                                ${request.name}
                            </a>
                        </div>
                        <span class="status-badge ${request.status}">
                            <i class="fas ${getStatusIcon(request.status)}"></i>
                            ${request.statusName}
                        </span>
                    </div>
                    
                    <div class="request-content">
                        <div class="request-description">
                            <p>${request.description}</p>
                            <div style="display: flex; gap: 15px; margin-top: 10px;">
                                <span style="background-color: #f8f9fa; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem;">
                                    <i class="fas fa-tag"></i> ${request.serviceName}
                                </span>
                                <span style="background-color: #f8f9fa; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem;">
                                    <i class="fas fa-flag"></i> Приоритет: ${request.priorityName}
                                </span>
                            </div>
                        </div>
                        
                        <div class="request-meta">
                            <div class="contractor-info">
                                <div class="contractor-avatar">
                                    <img src="${request.contractor.avatar}" alt="${request.contractor.name}" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                                </div>
                                <div class="contractor-details">
                                    <div class="contractor-name">${request.contractor.name}</div>
                                    <div class="contractor-role">${request.contractor.role}</div>
                                    <div style="font-size: 0.8rem; color: #666; margin-top: 4px;">
                                        <i class="fas fa-building"></i> ${request.contractor.company}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="request-footer">
                        <div class="request-date">
                            <i class="fas fa-calendar-alt"></i>
                            Создана: ${formatDate(request.createdAt)}
                            ${request.deadline ? `<br><i class="fas fa-hourglass-end"></i> Срок: ${formatDate(request.deadline)}` : ''}
                        </div>
                        <div class="request-actions">
                            <button class="action-btn" onclick="showRequestDetail('${request.id}')">
                                <i class="fas fa-eye"></i> Подробнее
                            </button>
                            ${canCancelRequest(request) ? `
                                <button class="action-btn" onclick="cancelRequest('${request.id}')">
                                    <i class="fas fa-times"></i> Отменить
                                </button>
                            ` : ''}
                            ${currentUser.role === 'admin' ? `
                                <button class="action-btn" onclick="openChangeStatusModal('${request.id}')">
                                    <i class="fas fa-edit"></i> Статус
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `}).join('');
            
            requestsList.innerHTML = requestsHTML;
        }

        // Проверка, может ли текущий пользователь отменить заявку
        function canCancelRequest(request) {
            if (request.status === 'completed' || request.status === 'cancelled') return false;
            if (currentUser.role === 'admin') return true;
            return request.userId === currentUser.id;
        }

        // ========== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ==========
        function getStatusIcon(status) {
            switch(status) {
                case 'new': return 'fa-circle';
                case 'processing': return 'fa-spinner';
                case 'completed': return 'fa-check-circle';
                case 'cancelled': return 'fa-times-circle';
                default: return 'fa-circle';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ========== ДЕТАЛЬНЫЙ ПРОСМОТР ЗАЯВКИ ==========
        window.showRequestDetail = function(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            document.getElementById('requestsListView').style.display = 'none';
            document.getElementById('requestDetailView').style.display = 'block';
            
            const statusBadge = document.getElementById('detailStatusBadge');
            statusBadge.className = `status-badge ${request.status}`;
            statusBadge.innerHTML = `<i class="fas ${getStatusIcon(request.status)}"></i> ${request.statusName}`;
            
            const timelineHTML = request.timeline.map(event => `
                <div class="timeline-item">
                    <div class="timeline-icon">
                        <i class="fas ${getStatusIcon(event.status)}"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-header">
                            <span class="timeline-status">${event.statusName}</span>
                            <span class="timeline-date">${formatDateTime(event.date)}</span>
                        </div>
                        <div class="timeline-comment">${event.comment}</div>
                    </div>
                </div>
            `).join('');

            // Информация о заказчике (для админа)
            const requesterBlock = (currentUser.role === 'admin' && request.userId !== currentUser.id) ? `
                <div style="margin-bottom: 30px; background-color: #f0f7ff; padding: 20px; border-radius: 12px;">
                    <h3 style="font-size: 1.2rem; color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-user" style="color: #2980b9;"></i>
                        Информация о заказчике
                    </h3>
                    <p><strong>Имя:</strong> ${request.userName || 'Не указано'}</p>
                    <p><strong>Email:</strong> ${request.userEmail || 'Не указан'}</p>
                </div>
            ` : '';

            const detailHTML = `
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px;">
                    <div>
                        <h2 style="font-size: 1.8rem; color: #2c3e50; margin-bottom: 10px;">${request.name}</h2>
                        <span class="request-id" style="background: none; padding-left: 0;">${request.id}</span>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 40px; margin-bottom: 40px;">
                    <div>
                        <h3 style="font-size: 1.2rem; color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-info-circle" style="color: #2980b9;"></i>
                            Описание заявки
                        </h3>
                        <p style="color: #666; line-height: 1.8; margin-bottom: 30px;">${request.description}</p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; background-color: #f8f9fa; padding: 25px; border-radius: 12px;">
                            <div>
                                <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Услуга</div>
                                <div style="font-weight: 600; color: #2c3e50;">${request.serviceName}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Приоритет</div>
                                <div style="font-weight: 600; color: #2c3e50;">${request.priorityName}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Дата создания</div>
                                <div style="font-weight: 600; color: #2c3e50;">${formatDate(request.createdAt)}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Желаемая дата</div>
                                <div style="font-weight: 600; color: #2c3e50;">${request.deadline ? formatDate(request.deadline) : 'Не указана'}</div>
                            </div>
                            ${request.completedAt ? `
                            <div>
                                <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Дата завершения</div>
                                <div style="font-weight: 600; color: #27ae60;">${formatDate(request.completedAt)}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div>
                        <h3 style="font-size: 1.2rem; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-user-tie" style="color: #2980b9;"></i>
                            Подрядчик
                        </h3>
                        <div style="background-color: #f8f9fa; padding: 25px; border-radius: 12px; text-align: center;">
                            <div style="margin-bottom: 15px;">
                                <img src="${request.contractor.avatar}" alt="${request.contractor.name}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                            </div>
                            <h4 style="font-size: 1.2rem; color: #2c3e50; margin-bottom: 5px;">${request.contractor.name}</h4>
                            <p style="color: #2980b9; font-weight: 500; margin-bottom: 10px;">${request.contractor.role}</p>
                            <p style="color: #666; margin-bottom: 20px;">
                                <i class="fas fa-building"></i> ${request.contractor.company}
                            </p>
                            <button class="profile-btn primary" style="width: 100%;">
                                <i class="fas fa-comment"></i> Связаться
                            </button>
                        </div>
                    </div>
                </div>

                ${requesterBlock}
                
                <div class="timeline">
                    <h3 class="timeline-title">
                        <i class="fas fa-history"></i>
                        История заявки
                    </h3>
                    <div class="timeline-items">
                        ${timelineHTML}
                    </div>
                </div>
                
                <div style="margin-top: 40px; display: flex; gap: 15px; justify-content: flex-end;">
                    <button class="profile-btn secondary" onclick="document.getElementById('backToListBtn').click()">
                        <i class="fas fa-arrow-left"></i> Вернуться
                    </button>
                    ${canCancelRequest(request) ? `
                        <button class="profile-btn logout" onclick="cancelRequest('${request.id}')">
                            <i class="fas fa-times"></i> Отменить заявку
                        </button>
                    ` : ''}
                    ${currentUser.role === 'admin' ? `
                        <button class="profile-btn primary" onclick="openChangeStatusModal('${request.id}')">
                            <i class="fas fa-edit"></i> Изменить статус
                        </button>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('requestDetailContent').innerHTML = detailHTML;
        };

        // ========== ОТМЕНА ЗАЯВКИ ==========
        window.cancelRequest = function(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            // Проверка прав
            if (!canCancelRequest(request)) {
                alert('У вас нет прав для отмены этой заявки');
                return;
            }

            if (confirm('Вы уверены, что хотите отменить заявку?')) {
                request.status = 'cancelled';
                request.statusName = 'Отменена';
                request.timeline.push({
                    date: new Date().toISOString(),
                    status: 'cancelled',
                    statusName: 'Отменена',
                    comment: currentUser.role === 'admin' ? 
                        'Заявка отменена администратором' : 
                        'Заявка отменена клиентом'
                });
                
                localStorage.setItem('requests', JSON.stringify(requests));
                
                // Обновляем отображение
                if (document.getElementById('requestDetailView').style.display === 'block') {
                    showRequestDetail(requestId);
                }
                
                // Перезагружаем список с учётом фильтрации
                const visibleRequests = currentUser.role === 'admin' ? 
                    requests : 
                    requests.filter(r => r.userId === currentUser.id);
                renderStats(visibleRequests);
                renderRequests(visibleRequests);
                
                alert('Заявка отменена');
            }
        };

        // ========== ИЗМЕНЕНИЕ СТАТУСА (ТОЛЬКО АДМИН) ==========
        let currentRequestForStatus = null;

        window.openChangeStatusModal = function(requestId) {
            if (currentUser.role !== 'admin') {
                alert('Только администратор может изменять статус');
                return;
            }
            currentRequestForStatus = requests.find(r => r.id === requestId);
            if (currentRequestForStatus) {
                document.getElementById('newStatus').value = currentRequestForStatus.status;
                document.getElementById('statusComment').value = '';
                document.getElementById('changeStatusModal').classList.add('active');
            }
        };

        // ========== НАСТРОЙКА ОБРАБОТЧИКОВ СОБЫТИЙ ==========
        function setupEventListeners() {
            // Новая заявка
            document.getElementById('newRequestBtn').addEventListener('click', function() {
                document.getElementById('newRequestModal').classList.add('active');
            });
            
            // Закрытие модалки новой заявки
            document.getElementById('closeModalBtn').addEventListener('click', function() {
                document.getElementById('newRequestModal').classList.remove('active');
            });
            
            // Закрытие модалки статуса
            document.getElementById('closeStatusModalBtn').addEventListener('click', function() {
                document.getElementById('changeStatusModal').classList.remove('active');
            });
            
            window.addEventListener('click', function(e) {
                const modal = document.getElementById('newRequestModal');
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
                const statusModal = document.getElementById('changeStatusModal');
                if (e.target === statusModal) {
                    statusModal.classList.remove('active');
                }
            });
            
            // Отправка формы новой заявки
            document.getElementById('newRequestForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newRequest = {
                    id: `REQ-${new Date().getFullYear()}-${String(requests.length + 1).padStart(3, '0')}`,
                    userId: currentUser.id,
                    userName: currentUser.name,
                    userEmail: currentUser.email,
                    name: document.getElementById('requestName').value,
                    service: document.getElementById('requestService').value,
                    serviceName: document.getElementById('requestService').selectedOptions[0].text,
                    description: document.getElementById('requestDescription').value,
                    priority: document.getElementById('requestPriority').value,
                    priorityName: document.getElementById('requestPriority').selectedOptions[0].text,
                    status: 'new',
                    statusName: 'Новая',
                    contractor: {
                        name: 'Ожидает назначения',
                        role: '',
                        company: 'ТаможСервис',
                        avatar: 'https://ui-avatars.com/api/?name=Ожидает+назначения&background=95a5a6&color=fff'
                    },
                    createdAt: new Date().toISOString(),
                    deadline: document.getElementById('requestDeadline').value,
                    completedAt: null,
                    timeline: [
                        {
                            date: new Date().toISOString(),
                            status: 'new',
                            statusName: 'Новая',
                            comment: 'Заявка создана'
                        }
                    ]
                };
                
                requests.unshift(newRequest);
                localStorage.setItem('requests', JSON.stringify(requests));
                
                // Закрываем модальное окно и обновляем список
                document.getElementById('newRequestModal').classList.remove('active');
                this.reset();
                
                // Обновляем отображение в зависимости от роли
                const visibleRequests = currentUser.role === 'admin' ? 
                    requests : 
                    requests.filter(r => r.userId === currentUser.id);
                renderStats(visibleRequests);
                renderRequests(visibleRequests);
                
                alert('Заявка успешно создана!');
            });
            
            // Изменение статуса (админ)
            document.getElementById('changeStatusForm').addEventListener('submit', function(e) {
                e.preventDefault();
                if (!currentRequestForStatus) return;
                
                const newStatus = document.getElementById('newStatus').value;
                const comment = document.getElementById('statusComment').value || 'Статус обновлён администратором';
                
                // Обновляем статус
                const oldStatus = currentRequestForStatus.status;
                const statusNames = {
                    'new': 'Новая',
                    'processing': 'В обработке',
                    'completed': 'Завершена',
                    'cancelled': 'Отменена'
                };
                
                currentRequestForStatus.status = newStatus;
                currentRequestForStatus.statusName = statusNames[newStatus];
                
                if (newStatus === 'completed') {
                    currentRequestForStatus.completedAt = new Date().toISOString();
                }
                
                currentRequestForStatus.timeline.push({
                    date: new Date().toISOString(),
                    status: newStatus,
                    statusName: statusNames[newStatus],
                    comment: comment
                });
                
                localStorage.setItem('requests', JSON.stringify(requests));
                
                // Закрываем модалку
                document.getElementById('changeStatusModal').classList.remove('active');
                
                // Обновляем отображение
                if (document.getElementById('requestDetailView').style.display === 'block') {
                    showRequestDetail(currentRequestForStatus.id);
                }
                
                const visibleRequests = currentUser.role === 'admin' ? 
                    requests : 
                    requests.filter(r => r.userId === currentUser.id);
                renderStats(visibleRequests);
                renderRequests(visibleRequests);
                
                alert('Статус заявки изменён');
            });
            
            // Кнопка возврата к списку
            document.getElementById('backToListBtn').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('requestDetailView').style.display = 'none';
                document.getElementById('requestsListView').style.display = 'block';
                
                const visibleRequests = currentUser.role === 'admin' ? 
                    requests : 
                    requests.filter(r => r.userId === currentUser.id);
                renderStats(visibleRequests);
                renderRequests(visibleRequests);
            });
            
            // Фильтры
            document.getElementById('applyFiltersBtn').addEventListener('click', applyFilters);
            document.getElementById('resetFiltersBtn').addEventListener('click', resetFilters);
            
            document.getElementById('searchFilter').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    applyFilters();
                }
            });
        }

        // ========== ФИЛЬТРАЦИЯ ==========
        function applyFilters() {
            let baseRequests = currentUser.role === 'admin' ? 
                requests : 
                requests.filter(r => r.userId === currentUser.id);
            
            const status = document.getElementById('statusFilter').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            const search = document.getElementById('searchFilter').value.toLowerCase();
            
            let filtered = [...baseRequests];
            
            if (status !== 'all') {
                filtered = filtered.filter(r => r.status === status);
            }
            
            if (dateFrom) {
                filtered = filtered.filter(r => new Date(r.createdAt) >= new Date(dateFrom));
            }
            
            if (dateTo) {
                filtered = filtered.filter(r => new Date(r.createdAt) <= new Date(dateTo + 'T23:59:59'));
            }
            
            if (search) {
                filtered = filtered.filter(r => 
                    r.name.toLowerCase().includes(search) || 
                    r.description.toLowerCase().includes(search) ||
                    r.id.toLowerCase().includes(search) ||
                    r.serviceName.toLowerCase().includes(search) ||
                    (r.userName && r.userName.toLowerCase().includes(search))
                );
            }
            
            renderStats(filtered);
            renderRequests(filtered);
        }

        function resetFilters() {
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('searchFilter').value = '';
            
            const baseRequests = currentUser.role === 'admin' ? 
                requests : 
                requests.filter(r => r.userId === currentUser.id);
            renderStats(baseRequests);
            renderRequests(baseRequests);
        }
    </script>
</body>
</html>